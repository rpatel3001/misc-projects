#include <iostream>
#include <ctime>
#include <chrono>
#include <thread>
#include <cctype>

void delay() {
	std::this_thread::sleep_for(std::chrono::milliseconds(150));
}

void explode() {
	system("clear");
	std::cout <<
	          "                          ((/))           \n"
	          "                         ((  ))           \n"
	          "                         ((( )            \n"
	          "                    -|-                   \n"
	          "                    -+-{#}                \n"
	          "         _,        ========_              \n"
	          "        __^________|[][][][]\\__()         \n"
	          "~~~~~~~~\\_______________________]~~~~~~~~~\n";
	delay();
	system("clear");
	std::cout << ""
	          "                           _/             \n"
	          "                         ((/))            \n"
	          "                    ^   ((  ))            \n"
	          "                    -|- ((( )  ^          \n"
	          "                   ^-+-{#}                \n"
	          "         _,        ========_              \n"
	          "        __^________|[][][][]\\__()         \n"
	          "~~~~~~~~\\_______________________]~~~~~~~~~\n";
	delay();
	system("clear");
	std::cout << ""
	          "                          //             \n"
	          "                  ^      _/        ^     \n"
	          "                       ((/))  ^          \n"
	          "            ^       -|((  ))             \n"
	          "              ^   ^-+((( ) ^  ^ ^       \n"
	          "         _,  ^    ^========_             \n"
	          "        __^________|[][][][]\\__()        \n"
	          "~~~~~~~~\\_______________________]~~~~~~~~~\n";
	delay();
	system("clear");
	std::cout << ""
	          "                          //            \n"
	          "                         //             \n"
	          "                  ^     _/  ^           \n"
	          "             ^  ^   ^ ((/))  ^          \n"
	          "             ^  ^   ^((  )) ^   ^       \n"
	          "         _,    ^   ==((( )=_  ^^ ^      \n"
	          "        __^________|[][][][]\\__()       \n"
	          "~~~~~~~~\\_______________________]~~~~~~~~~\n";
	delay();
	system("clear");
	std::cout << ""
	          "      ^                   //          ^ \n"
	          "      ^ ^      ^   ^     //    ^  ^     \n"
	          "           ^    -|-  ^  //    ^         \n"
	          "        ^  ^        ^  _/    ^   ^{#}   \n"
	          "          ^^ ++ ^   ^  ((/))      ^  ^  \n"
	          "                 ^ =((  )=_   ^   ^     \n"
	          "        __^________|((()][]\\__()        \n"
	          "~~~~~~~~\\_______________________]~~~~~~~~~\n";
	delay();
	system("clear");
	std::cout << ""
	          "      ^    ^      ^   ^  //      ^     \n"
	          "   ^       -|-^   ^      //   ^        \n"
	          "     ^   ^             ^// ))=  {#}     \n"
	          "         ^ ++ ^  ^  ^  //   ^   ^       \n"
	          "             ^      ^_/  ^   ^    ^    \n"
	          "      ((=_,   ^  \' =((/))=^_  ^         \n"
	          "        __^_____\\__^((  \\) ^\\__()       \n"
	          "~~~~~~~~\\_________\\(((~)~\\______]~~~~~~~~~\n";
	delay();
	system("clear");
	std::cout << ""
	          "                          //      {#}   \n"
	          "       -|-               //      //\\/   \n"
	          "        ^               //              \n"
	          "  ((=     ^    ^       //    ++         \n"
	          "      ^  ^     ^     ^//  ^    ^ ^))+   \n"
	          "     ^   \\/  ^   \'^ _/  ^   ^          \n"
	          "   ^    __^_____/\\//((  )) ^\\__()       \n"
	          "~~~~~~~~\\_______\\(((~)///_____]~^~~~~~~~\n";
	delay();
	system("clear");
	std::cout << ""
	          "        ^                  //           \n"
	          "                          //            \n"
	          "                         ^/             \n"
	          "                        //       {#}    \n"
	          "  -|-         ^ \'      /^   \' ^    ^   \n"
	          "     ^   //\\     \'    //  \'     ++      \n"
	          "  ^  ^      ^ \'((= \' _/\'  +   ^   ^     \n"
	          "~~~~^~~~~_~~~__~_~~~____~~__~__~~~~~~~~~~~\n";
	delay();
	system("clear");
	std::cout << ""
	          "                           //           \n"
	          "                          //            \n"
	          "                         //             \n"
	          "                 ^      //              \n"
	          "              \'        //   ^   ^       \n"
	          "              ^\'  \' ^\'//   ^ \'          \n"
	          "              \'++ ^\' // \'^\' \'{#}        \n"
	          "~~~~~~-|-~~~~~~~((\\)//\\~/)~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                            /            \n"
	          "                          //             \n"
	          "                         //              \n"
	          "                        //               \n"
	          "                ^   ^\\\' //  \' ^          \n"
	          "             \'  \' \'   //   \' \'^          \n"
	          "              -=-\\^ ~~/  \\+ \'           \n"
	          "~~~~~~~~~~~~~~++~^~~( \\ )~{#}~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                           /             \n"
	          "                           /             \n"
	          "                         //              \n"
	          "               \\\'        //              \n"
	          "        \'   \\/\\ \\\'    \\\'//\\\'  \'         \n"
	          "          \' \'    \'  ~~//     \'   \'       \n"
	          "            \'  //\\ \\\'(  ) \\\'  \\//        \n"
	          "~~~~~~~~~~~~~~~~~~~(  / )~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                            /            \n"
	          "                          /              \n"
	          "           \'        \\\'     /             \n"
	          "               \\\'      \\\' //  \'  \'       \n"
	          "          \'   \'  \\\' ~~~~//\\\'  \' \'        \n"
	          "            \'     (    )     \\/*$        \n"
	          "           \' \'\\\'  (\\\'(  ) )\\\' \'    \'     \n"
	          "~~~~~~~~~~~~~~~~~~~(  / )~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                                         \n"
	          "                          /    /////     \n"
	          "                          /              \n"
	          "                        /                \n"
	          "               \' ^ \'  \\\'^/  ^\'           \n"
	          "               \'#^\'    //   \'            \n"
	          "               ^\\\'  (  )   ^\'+  ^        \n"
	          "~~~~~~~~~~~~~~~~~~~(  / )~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                                         \n"
	          "                                         \n"
	          "                                         \n"
	          "                        /   ^            \n"
	          "                  \'  ^^ /      -|        \n"
	          "          ^        ^ \\\'/^       ^        \n"
	          "    ^     ^   ^  |\\\'=^  ^\'  ^            \n"
	          "~~~~~~~~~~~~~~~~~~~~( /)~~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                                         \n"
	          "                                         \n"
	          "                                         \n"
	          "                                         \n"
	          "                                         \n"
	          "                  ^   /^1               \n"
	          "                  ^\'#\' /\\^               \n"
	          "~~~~~~~~~~~~~~~~~~~~~()~~~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                                          \n"
	          "                                          \n"
	          "                                          \n"
	          "                                          \n"
	          "                                          \n"
	          "                                          \n"
	          "                                          \n"
	          "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << "\n\n\n"
	          "########   ########  ########  ##      ##  \n"
	          "#       #  #      #  #      #  # #    # #  \n"
	          "#       #  #      #  #      #  # #    # #  \n"
	          "########   #      #  #      #  #  #  #  #  \n"
	          "#       #  #      #  #      #  #  #  #  #  \n"
	          "#       #  #      #  #      #  #   ##   #  \n"
	          "########   ########  ########  #   ##   #  \n"
	          "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\n";
}

void miss() {
	system("clear");
	std::cout << ""
	          "                          ((/))           \n"
	          "                         ((  ))           \n"
	          "                         ((( )            \n"
	          "                                          \n"
	          "                                          \n"
	          "                                          \n"
	          "                                          \n"
	          "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                           _/             \n"
	          "                         ((/))            \n"
	          "                        ((  ))            \n"
	          "                        ((( )             \n"
	          "                                          \n"
	          "                                          \n"
	          "                                          \n"
	          "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                          //            \n"
	          "                         _/             \n"
	          "                       ((/))            \n"
	          "                      ((  ))            \n"
	          "                      ((( )             \n"
	          "                                        \n"
	          "                                        \n"
	          "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                          //            \n"
	          "                         //             \n"
	          "                        _/              \n"
	          "                      ((/))             \n"
	          "                     ((  ))             \n"
	          "                     ((( )              \n"
	          "                                        \n"
	          "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                          //            \n"
	          "                         //             \n"
	          "                        //              \n"
	          "                       _/               \n"
	          "                     ((/))              \n"
	          "                    ((  ))              \n"
	          "                    ((( )              \n"
	          "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                          //            \n"
	          "                         //             \n"
	          "                        //              \n"
	          "                       //               \n"
	          "                      _/                \n"
	          "                 \'  ((/))               \n"
	          "                  \'((  )) \'             \n"
	          "~~~~~~~~~~~~~~~~~~~(((~)~~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                          //            \n"
	          "                         //             \n"
	          "                        //              \n"
	          "                       //               \n"
	          "                      //                \n"
	          "                  \'  _/                 \n"
	          "                 \' ((/))\' \'             \n"
	          "~~~~~~~~~~~~~~~~~~(((~)))~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                           //           \n"
	          "                          //            \n"
	          "                         //             \n"
	          "                        //              \n"
	          "                \'      //   \'           \n"
	          "                 \'    //  \'             \n"
	          "              \' \'  \' _/\'  \'             \n"
	          "~~~~~~~~~~~~~~~~~(\\(\\/\\)/)~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                           //           \n"
	          "                          //            \n"
	          "                         //             \n"
	          "                        //              \n"
	          "              \'        //               \n"
	          "               \'  \'  \'//   \' \'          \n"
	          "              \'    \' // \' \' \'           \n"
	          "~~~~~~~~~~~~~~~~((\\)//\\~/)~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                            /           \n"
	          "                          //            \n"
	          "                         //             \n"
	          "                        //              \n"
	          "                \'    \\\' //  \'            \n"
	          "             \'  \' \'   //   \' \'          \n"
	          "                \' \\\' ~~/  \\\' \'            \n"
	          "~~~~~~~~~~~~~~~~~~~~( \\ )~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                           /            \n"
	          "                           /            \n"
	          "                         //             \n"
	          "               \\\'        //              \n"
	          "        \'   \'    \\\'    \\\'//\\\'  \'           \n"
	          "          \' \'    \'  ~~//     \'   \'      \n"
	          "            \'  \\\'  \\\'(  ) \\\'   \'           \n"
	          "~~~~~~~~~~~~~~~~~~~(  / )~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                            /           \n"
	          "                          /             \n"
	          "           \'        \\\'     /             \n"
	          "               \\\'      \\\' //  \'  \'        \n"
	          "          \'   \'  \\\' ~~~~//\\\'  \' \'         \n"
	          "            \'     (    )     \'   \'      \n"
	          "           \' \'\\\'  (\\\'(  ) )\\\' \'    \'       \n"
	          "~~~~~~~~~~~~~~~~~~~(  / )~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                                        \n"
	          "                          /    /////    \n"
	          "                          /             \n"
	          "                        /               \n"
	          "               \'   \'  \\\'//   \'           \n"
	          "               \' \\\'    //   \'            \n"
	          "               \'\\\'  (  )   \\\''  \'         \n"
	          "~~~~~~~~~~~~~~~~~~~(  / )~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                                        \n"
	          "                                        \n"
	          "                                        \n"
	          "                        /               \n"
	          "                  \'     /               \n"
	          "                     \\\'/\'                \n"
	          "                 \'\\\'     \'               \n"
	          "~~~~~~~~~~~~~~~~~~~~( /)~~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                                        \n"
	          "                                        \n"
	          "                                        \n"
	          "                                        \n"
	          "                                       \n"
	          "                      / \'               \n"
	          "                   \'\\\' /                 \n"
	          "~~~~~~~~~~~~~~~~~~~~~()~~~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                                          \n"
	          "                                          \n"
	          "                                          \n"
	          "                                          \n"
	          "                                          \n"
	          "                                          \n"
	          "                                          \n"
	          "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\n";
	delay();
	system("clear");
	std::cout << ""
	          "                                      \n"
	          "                                      \n"
	          "                                      \n"
	          "####    #### ######  #####  #####     \n"
	          "## ##  ## ##   ##   ###    ###        \n"
	          "##  ####  ##   ##    ####   ####      \n"
	          "##   ##   ##   ##      ###    ###     \n"
	          "##        ## ###### #####  #####      \n"
	          "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\n";
}

void display(char (&board)[10][10]) {
	system("clear");
	std::cout << "    a b c d e f g h i j" << std::endl;
	std::cout << "   --------------------" << std::endl;
	int index = 0;
	for (auto &row : board) {
		std::cout << index++ << " | ";
		for (char x : row) {
			if (std::isupper(x)) {
				std::cout << x << " ";
			} else {
				std::cout << "- ";
			}
		}
		std::cout << std::endl;
	}
}

bool isnumber(std::string s) {
	for (unsigned int i = 0; i < s.length(); i++) {
		if (!isdigit(s[i]))
			return false;
	}

	return true;
}

int main() {
	//shown board ships are invisible
	srand((unsigned)time(0));

	int randX, randY, dir;
	//hidden board, shows ships
	char board[10][10];
	//make all the coordinates -'s
	for (auto &row : board) {
		for (char &x : row) {
			x = '-';
		}
	}
	//make 10 random ships 3 boxes long
	for (int a = 0; a < 5; a++) {
		dir = rand() % 2;
		randX = rand() % 7;
		randY = rand() % 7;

		if (board[randX][randY] != 's') {
			for (int o = 0; o < 3; o++) {
				if (dir == 0) {
					board[randX + o][randY] = 's';
				} else {
					board[randX][randY + o] = 's';
				}
			}

		} else {
			a--;
		}
	}

	int ships = 0;
	for (auto &row : board) {
		for (char x : row) {
			if (x == 's') {
				ships++;
			}
		}
	}

	bool endGame = false;
	int shots = 0;
	const int maxShots = 20;
	do {
		display(board);
		std::cout << "You have " << maxShots - shots << " shots left.\n";
		std::string xC, yC;
		std::cout << "Input x and y coordinates, separated by a space (e.g. a 7): ";
		std::cin >> yC >> xC;
		//make strings into integers
		int yCoord = yC.c_str()[0] - 'a';
		int xCoord = atoi(xC.c_str());
		//determine if number is not an integer
		if (yC.size() > 1 || !isnumber(xC)) {
			std::cout << "Coordinates were not in the right format. \n";
			display(board);
			continue;
		}
		//determine if coordinates are inside grid
		if (xCoord < 0 || xCoord > 9 || yCoord < 0 || yCoord > 9) {
			std::cout << "Coordinates out of range. \n";
			display(board);
			continue;
		}
		//if coord is not a ship
		if (board[xCoord][yCoord] == '-') {
			miss();
			delay();
			std::cout << "You missed.\n";
			shots++;
			board[xCoord][yCoord] = 'O';
			display(board);
			if (shots >= maxShots) {
				endGame = true;
				std::cout << "You lose! ";
				continue;
			}
			continue;
		}
		// if coord is ship
		else if (board[xCoord][yCoord] == 's') {
			system("clear");
			explode();
			delay();
			std::cout << "You got part of a ship! From the wreckage you salvage some ammo!\n";
			board[xCoord][yCoord] = 'X';
			display(board);
			shots--;
			int kills = 0;
			for (auto &row : board) {
				for (char x : row) {
					if (x == 'X') {
						kills++;
					}
				}
			}
			if (kills == ships) {
				endGame = true;
				std::cout << "You win! ";
				continue;
			}

			continue;
		}
		//if coord has been shot on before
		else if (board[xCoord][yCoord] == 'O' || board[xCoord][yCoord] == 'X') {
			std::cout << "You already shot there! Pick a new coordinate.\n";
			display(board);
			continue;
		}
	} while (!endGame);
	std::cout << std::endl;
}
